import { Head, Image, Appear } from 'mdx-deck';

<Head>
	<title>React Performance</title>
	<meta name='viewport' content='width=device-width, initial-scale=1.0' />
	<meta name='keywords' content='React, Performance' />
	<meta
		name='description'
		content='Slides for presentation on react performance.'
	/>
	<meta name='author' content='Sibasish Mohanty' />
</Head>

# React Performance

### Sibasish Mohanty

---

## What this talk is

<ul>
	<Appear>
		<li>Understand when (not) to go for performance optimization</li>
		<li>Monitor the performance and identify the cause</li>
		<li>Get familiar with right tools and techniques</li>
	</Appear>
</ul>

---

## What this talk is _not_

<ul>
	<Appear>
		<li>More focus on runtime performance than loadtime performance</li>
		<li>SSR, CDN, Web Workers, Throttling and Debouncing</li>
		<li>How a particular tool works</li>
	</Appear>
</ul>

---

### How do you if you have a performance problem?

<ul>
	<Appear>
		<li>You probably don't</li>
		<li>Loadtime performance vs Runtime performance</li>
		<li>You sholudn't optimize prematurely</li>
		<li>Performance optimizations are not free</li>
	</Appear>
</ul>

---

## The production build

- By default, React includes many useful warnings for development. However, they
  make React larger and slower.

- Use the
  [production version](https://reactjs.org/docs/optimizing-performance.html#use-the-production-build)
  when you deploy the app.

---

## Bundling and minification

- Remove unnecessary modules and replace large modules with smaller alternatives
- Analyze bundle size with
  [webpack bundle analyzer](https://www.npmjs.com/package/webpack-bundle-analyzer)
- Serve minified bundle in production with
  [compression webpack plugin](https://webpack.js.org/plugins/compression-webpack-plugin/)
- Helped reducing canvas bundle size from 25.9 MB to 5.8 MB and impoved the time
  to interactive by 75%

---

## Code splitting

- Loading less code will speed up your app
- Dynamic imports with `<React.Suspense />` and `React.lazy()`
- Eager loading and prefetching dynamic imports for better UX

---

import { LazyLoad } from './components/lazy-load';

<LazyLoad />

---

## Memoize expensive calculations

- Bulky functions executed in every single render cycle
- Memoized functions run when the results actually needs to be re-evaluated
- Don't overuse `useMemo` and `useCallback`

---

### Which one is better for performance?

import { Highlighter } from './components/highlighter';

<Highlighter>{`const removeUser = user => {
  setUser(allUsers => allUsers.filter(u => u !== user))
}
`}</Highlighter>

... And the one with `useCallback`

<Highlighter>{`const removeUser = React.useCallback(user => {
  setUser(allUsers => allUsers.filter(u => u !== user))
}, [])
`}</Highlighter>

---

### Every line of code which is executed comes with a cost

<Highlighter>
	{`const removeUser = user => {
  setUser(allUsers => allUsers.filter(u => u !== user))
}
const removeUserCallback = React.useCallback(removeUser, []);
`}
</Highlighter>

... And here is the original one

<Highlighter>{`const removeUser = user => {
  setUser(allUsers => allUsers.filter(u => u !== user))
}
`}</Highlighter>

---

## Avoid unndecessary re-renders

- Immutability and reference equality
- A `PureComponent` is going to be _usually_ slower and _ocassionally_ faster
- Optimze slow renders before fixing re-renders
- Virtualize large list of data with
  [react-virtualized](https://bvaughn.github.io/react-virtualized/#/wizard)

---

import Memoize from './components/memoize';

<Memoize />

---

### Cost vs Benefit

<ol>
	<Appear>
		<li>Bundling and minification</li>
		<li>Code splitting</li>
		<li>Memoize expensive calculations</li>
		<li>Virtualize long lists</li>
		<li>Avoid unnecessay re-renders</li>
	</Appear>
</ol>

---

## Conclusion

<ul>
	<Appear>
		<li>Write your code naturally, code to the design</li>
		<li>Performance optimizations may not offset the cost it comes with</li>
		<li>
			If you aren’t measuring, you can’t even know if your optimizations are
			better
		</li>
	</Appear>
</ul>

---

# Thank you
